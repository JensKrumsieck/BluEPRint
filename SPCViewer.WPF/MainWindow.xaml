<controls:DefaultWindow x:Class="SPCViewer.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converter="clr-namespace:SPCViewer.WPF.Converter"
        xmlns:extension="clr-namespace:SPCViewer.WPF.Extension" 
        xmlns:viewmodel="clr-namespace:SPCViewer.ViewModel;assembly=SPCViewer.ViewModel"
        xmlns:controls="clr-namespace:ThemeCommons.Controls;assembly=ThemeCommons"
        d:DataContext="{d:DesignInstance Type=viewmodel:MainViewModel}"
        x:Name="Window"
        IconSize="24"
        mc:Ignorable="d"
        TitlebarHeight="55" 
        Background="{DynamicResource Dark}"
        Icon="Resources/spc_icon.ico"
        Style="{DynamicResource WindowStyle}"
        AllowDrop="True" Height="700" MinHeight="600" Width="1440" MinWidth="1280">
    <controls:DefaultWindow.TitlebarContent>
        <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="275"/>
                <!--title-->
                <ColumnDefinition Width="300"/>
                <!--open save col-->
                <ColumnDefinition/>
                <!--toolbar col-->
            </Grid.ColumnDefinitions>
            <Label Content="SPCViewer" FontSize="16" Foreground="{DynamicResource Light}" FontWeight="SemiBold"/>
            <StackPanel Orientation="Horizontal" Grid.Column="1">
                <ToolBarTray Style="{DynamicResource MaterialDesignToolBarTray}" Background="{StaticResource Background}" WindowChrome.IsHitTestVisibleInChrome="True">
                    <ToolBar Style="{DynamicResource ToolbarStyle}">
                        <Button Style="{DynamicResource ToolbarButton}" Click="Open_Click" extension:ControlExtensions.Icon="Folder" ToolTip="Open"/>
                        <Button Style="{DynamicResource ToolbarButton}" Click="Save_Click" extension:ControlExtensions.Icon="ContentSave" ToolTip="Save"
                            IsEnabled="{Binding Path=SelectedItem, Converter={converter:NotNullConverter}}"/>
                    </ToolBar>
                </ToolBarTray>
                <TextBlock Text="{Binding Path=SelectedItem.Title}" VerticalAlignment="Center"/>
            </StackPanel>
            <ToolBarTray Grid.Column="2" Style="{DynamicResource MaterialDesignToolBarTray}" Background="{StaticResource Background}" WindowChrome.IsHitTestVisibleInChrome="True"
                         HorizontalAlignment="Right" Margin="0 0 150 0">
                <ToolBar Style="{DynamicResource ToolbarStyle}" Background="{StaticResource Background}" VerticalAlignment="Bottom">
                    <ListBox SelectedIndex="{Binding SelectedItem.MouseAction, Mode=TwoWay, IsAsync=True, Converter={converter:UIActionToIntConverter}}" 
                         Background="Transparent" SelectionMode="Single" IsEnabled="{Binding Path=SelectedItem, Converter={converter:NotNullConverter}}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="MagnifyScan" ToolTip="Zoom"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="EyeDropperVariant" ToolTip="Tracker"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="FitToPageOutline" ToolTip="Normalize"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="BoxCutter" ToolTip="Peak Picking"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="MathIntegral" ToolTip="Integrate"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="EyedropperPlus" ToolTip="PickValue"/>
                    </ListBox>
                    <Separator Style="{StaticResource SeparatorStyle}"/>
                    <ListBox SelectionMode="Extended" SelectionChanged="Series_VisibleChanged"  Background="Transparent" 
                         IsEnabled="{Binding Path=SelectedItem, Converter={converter:NotNullConverter}}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="Delta" ToolTip="Show Derivative"
                                 IsSelected="{Binding SelectedItem.SelectedItem.DerivSeries.IsVisible, Mode=TwoWay, IsAsync=True}"/>
                        <ListBoxItem Style="{StaticResource ToolbarListItem}" extension:ControlExtensions.Icon="MathIntegralBox" ToolTip="Show Integral"
                                 IsSelected="{Binding SelectedItem.SelectedItem.IntegralSeries.IsVisible, Mode=TwoWay, IsAsync=True}"/>
                    </ListBox>
                </ToolBar>
            </ToolBarTray>
        </Grid>
    </controls:DefaultWindow.TitlebarContent>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="275"/>
            <ColumnDefinition />
            <ColumnDefinition Width="275"/>
            <ColumnDefinition Width="0.417"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="2*"/>
        </Grid.RowDefinitions>
        <DockPanel Grid.Row="0" Grid.Column="0">
            <Grid DockPanel.Dock="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="35"/>
                </Grid.ColumnDefinitions>
                <TextBlock Margin="10 10 10 0" FontSize="14" Foreground="{DynamicResource Light}"
                           FontWeight="SemiBold" Text="Documents"/>
                <Button Grid.Column="1"
                        ToolTip="Create Document"
                        FontSize="12" Width="24" Height="24"
                        Click="DocumentCreate_OnClick"
                        Background="{DynamicResource HoverColor}"
                        Content="&#xE710;" Style="{DynamicResource RoundedActionButtonStyle}"/>
            </Grid>
            <ListBox Margin="10" 
                     ItemsSource="{Binding Path=Items}" 
                     ItemContainerStyle="{DynamicResource ListBoxItemSidebarStyle}"
                     BorderThickness="0"
                     SelectedIndex="{Binding SelectedIndex}"
                     ItemTemplate="{StaticResource DocumentList}"/>
        </DockPanel>
        <DockPanel Grid.Column="0" Grid.Row="0" Margin="0,228,0,0" Grid.RowSpan="2">
            <Grid DockPanel.Dock="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="35"/>
                </Grid.ColumnDefinitions>
                <TextBlock Margin="10 10 10 0" FontSize="14" Foreground="{DynamicResource Light}"
                           FontWeight="SemiBold" Text="Spectra"/>
                <Button Grid.Column="1"
                        FontSize="12" Width="24" Height="24"
                        Click="Open_Click"
                        ToolTip="Open Spectrum"
                        Background="{DynamicResource HoverColor}"
                        Content="&#xE710;" Style="{DynamicResource RoundedActionButtonStyle}"/>
            </Grid>
            <ListBox Margin="10" ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ItemsSource="{Binding Path=SelectedItem.Items}" 
                     ItemContainerStyle="{DynamicResource ListBoxItemSidebarStyle}"
                     BorderThickness="0"
                     SelectedIndex="{Binding SelectedItem.SelectedIndex}"
                     ItemTemplate="{StaticResource SeriesList}"/>
        </DockPanel>
        <TabControl x:Name="TabContainer" ContentTemplate="{StaticResource TabTemplate}" 
                    Grid.Column="1" Grid.RowSpan="2" Grid.Row="0"
                    ItemsSource="{Binding Path=Items}" Drop="OnFileDrop" 
                    SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </Style>
            </TabControl.ItemContainerStyle>
        </TabControl>
        <StackPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="2"></StackPanel>
    </Grid>
</controls:DefaultWindow>
